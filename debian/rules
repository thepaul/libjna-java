#!/usr/bin/make -f

export JAVA_HOME=/usr/lib/jvm/java-6-openjdk

VERSION=$(shell dpkg-parsechangelog | sed -rne 's,^Version: ([^-]+).*,\1,p')

override_dh_auto_clean:
	if [ -f nbproject/profiler-build-impl.xml ]; then \
		ant -f build.xml clean; \
	fi
	rm -f build.number

	dh_clean

override_dh_auto_build:
	ant -f build.xml -Dcflags_extra.native="" -Ddynlink.native=true -Dnomixedjar.native=true jar
	ant -f build.xml javadoc

override_dh_auto_install:
	install -D -m 0644 build/jna.jar debian/libjna-java/usr/share/java/jna-$(VERSION).jar
	if [ -L debian/libjna-java/usr/share/java/jna.jar ]; then rm debian/libjna-java/usr/share/java/jna.jar; fi
	ln -s jna-$(VERSION).jar debian/libjna-java/usr/share/java/jna.jar

override_dh_makeshlibs:
	# don't call dh_makeshlibs

binary: binary-arch binary-indep

%:
	dh $@
